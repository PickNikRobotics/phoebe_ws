<?xml version="1.0" encoding="UTF-8" ?>
<root BTCPP_format="4" main_tree_to_execute="Get Can Pose">
  <!--//////////-->
  <BehaviorTree ID="Get Can Pose" _description="" _favorite="false">
    <Control ID="Sequence" name="TopLevelSequence">
      <SubTree
        ID="Segment Point Cloud from Text Prompt Subtree"
        _collapsed="false"
        camera_topic_name="/camera/left_wrist_mounted_camera/color/camera_info"
        clip_model_path="models/clip.onnx"
        clipseg_model_path="models/clipseg.onnx"
        decoder_model_path="models/decoder.onnx"
        encoder_model_path="models/sam2_hiera_large_encoder.onnx"
        erosion_size="2"
        image_topic_name="/camera/left_wrist_mounted_camera/color/image_raw"
        masks_visualization_topic="/masks_visualization"
        masks3d="{masks3d}"
        model_package="dual_arm_mobile_hw"
        point_cloud="{point_cloud}"
        point_cloud_vector="{point_cloud_vector}"
        points_topic_name="/camera/left_wrist_mounted_camera/depth/color/points"
        prompts="orange beer can"
        threshold="0.28"
      />
      <Decorator
        ID="ForEach"
        index="{index}"
        out="{point_cloud_fragment}"
        vector_in="{point_cloud_vector}"
      >
        <Control ID="Sequence">
          <Action
            ID="GetCentroidFromPointCloud"
            output_pose="{can_pose}"
            point_cloud="{point_cloud_fragment}"
          />
          <Action
            ID="TransformPose"
            input_pose="{can_pose}"
            output_pose="{can_grasp_pose}"
            quaternion_xyzw="0;0;1;0"
            translation_xyz="0;-0.02;0"
          />
          <Action
            ID="VisualizePose"
            marker_lifetime="0.000000"
            marker_name="can_centroid"
            marker_size="0.100000"
            pose="{can_grasp_pose}"
          />
        </Control>
      </Decorator>
    </Control>
  </BehaviorTree>
  <TreeNodesModel>
    <SubTree ID="Get Can Pose">
      <MetadataFields>
        <Metadata runnable="true" />
        <Metadata subcategory="Demo Subtrees" />
      </MetadataFields>
      <output_port name="can_grasp_pose" default="{can_grasp_pose}" />
    </SubTree>
  </TreeNodesModel>
</root>
