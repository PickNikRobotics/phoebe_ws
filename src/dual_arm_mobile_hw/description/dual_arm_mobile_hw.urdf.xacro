<?xml version="1.0" ?>
<robot name="phoebe" xmlns:xacro="http://wiki.ros.org/xacro">
  <!-- Args that users may need to change. -->
  <xacro:arg name="left_lift_comm_port" default="/dev/ttyUSB1"/>
  <xacro:arg name="right_lift_comm_port" default="/dev/ttyUSB2"/>
  <xacro:arg name="use_fake_lift_hardware" default="true"/>
  <xacro:arg name="left_arm_ip" default="192.168.131.4"/>
  <xacro:arg name="left_tool_device_name" default="/dev/ttyUSB0"/>
  <xacro:arg name="right_arm_ip" default="192.168.131.3"/>
  <xacro:arg name="right_tool_device_name" default="/tmp/ttyUR"/>
  <xacro:arg name="left_gripper_comm_port" default="/dev/ttyUSB0"/>
  <xacro:arg name="right_gripper_comm_port" default="/tmp/ttyUR"/>
  <xacro:arg name="left_arm_kinematics_hash" default="calib_10848939019749023817"/>
  <xacro:arg name="right_arm_kinematics_hash" default="calib_5972249097379105770"/>


  <!-- Mobile base joints -->
  <link name="world"/>
  <link name="virtual_rail_link_1"/>
  <joint name="linear_x_joint" type="prismatic">
    <axis xyz="1 0 0"/>
    <parent link="world"/>
    <child link="virtual_rail_link_1"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <limit acceleration="10.0" effort="1000.0" lower="-100.0" upper="100.0" velocity="0.2"/>
    <dynamics damping="20.0" friction="500.0"/>
  </joint>
  <link name="virtual_rail_link_2"/>
  <joint name="linear_y_joint" type="prismatic">
    <axis xyz="0 1 0"/>
    <parent link="virtual_rail_link_1"/>
    <child link="virtual_rail_link_2"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <limit acceleration="10.0" effort="1000.0" lower="-100.0" upper="100.0" velocity="0.2"/>
    <dynamics damping="20.0" friction="500.0"/>
  </joint>
  <link name="base_link"/>
  <joint name="rotational_yaw_joint" type="continuous">
    <axis xyz="0 0 1"/>
    <parent link="virtual_rail_link_2"/>
    <child link="base_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <limit effort="150.0" velocity="0.2"/>
    <dynamics damping="0" friction="0"/>
  </joint>
  <ros2_control name="clearpath_controller_interface" type="system">
    <hardware>
      <plugin>clearpath_controller_interface/ClearpathControllerInterface</plugin>
      <param name="odom_topic">/r100_0599/platform/odom/offset</param>
      <param name="cmd_vel_topic">/r100_0599/platform/cmd_vel_unstamped</param>
      <param name="max_linear_velocity">1.0</param>
      <param name="max_angular_velocity">1.0</param>
      <param name="cmd_pub_rate">50</param>
      <param name="active_on_startup">false</param>
    </hardware>
    <joint name="linear_x_joint"/>
    <joint name="linear_y_joint"/>
    <joint name="rotational_yaw_joint"/>
  </ros2_control>

  <!-- Mobile base -->
  <xacro:include filename="$(find dual_arm_mobile_description)/xacro/clearpath_r100.macro.xacro"/>
  <xacro:clearpath_r100
      parent_link="base_link"
      generate_ros2_control_tag="true"
  >
  </xacro:clearpath_r100>

  <!-- Lifts -->
  <xacro:include filename="$(find dual_arm_mobile_description)/xacro/ewellix_tlt500.macro.xacro" />
  <!-- Left lift -->
  <xacro:ewellix_tlt500
      parent_link="default_mount"
      prefix="lift_left_"
      generate_ros2_control_tag="true"
      lift_comm_port="$(arg left_lift_comm_port)"
      use_fake_lift_hardware="$(arg use_fake_lift_hardware)"
  >
    <origin rpy="0.0 0.0 0.0" xyz="0.0 0.2 0.04"/>
  </xacro:ewellix_tlt500>
  <!-- Right lift -->
  <xacro:ewellix_tlt500
      parent_link="default_mount"
      prefix="lift_right_"
      generate_ros2_control_tag="true"
      lift_comm_port="$(arg right_lift_comm_port)"
      use_fake_lift_hardware="$(arg use_fake_lift_hardware)"
  >
    <origin rpy="0.0 0.0 0.0" xyz="0.0 -0.2 0.04"/>
  </xacro:ewellix_tlt500>

  <!-- Arms -->
  <xacro:include filename="$(find dual_arm_mobile_description)/xacro/ur5e.macro.xacro" />
  <!-- Left arm -->
  <xacro:ur5e
    parent_link="left_arm_mount_plate_2"
    prefix="left_"
    generate_ros2_control_tag="true"
    robot_ip="$(arg left_arm_ip)"
    reverse_port="50001"
    script_sender_port="50002"
    script_command_port="50004"
    trajectory_port="50003"
    tool_device_name="$(arg left_tool_device_name)"
    tool_tcp_port="54320"
    kinematics_hash="$(arg left_arm_kinematics_hash)"
    >
    <origin rpy="0 0 -0.7853981633974483" xyz="0 0 0"/>
  </xacro:ur5e>
  <!-- Right arm -->
  <xacro:ur5e
      parent_link="right_arm_mount_plate_2"
      prefix="right_"
      generate_ros2_control_tag="true"
      robot_ip="$(arg right_arm_ip)"
      reverse_port="50005"
      script_sender_port="50006"
      script_command_port="50008"
      trajectory_port="50007"
      tool_device_name="$(arg right_tool_device_name)"
      tool_tcp_port="54321"
      kinematics_hash="$(arg right_arm_kinematics_hash)"
  >
    <origin rpy="0 0 -2.356194490192345" xyz="0 0 0"/>
  </xacro:ur5e>

  <!-- Grippers -->
  <xacro:include filename="$(find dual_arm_mobile_description)/xacro/robotiq_2f85.macro.xacro"/>
  <!-- Left gripper -->
  <xacro:robotiq_2f85
      parent_link="left_realsense_camera_adapter_tool0"
      prefix="left_"
      generate_ros2_control_tag="true"
      gripper_comm_port="$(arg left_gripper_comm_port)"
  >
  </xacro:robotiq_2f85>
  <!-- Right gripper -->
  <xacro:robotiq_2f85
      parent_link="right_realsense_camera_adapter_tool0"
      prefix="right_"
      generate_ros2_control_tag="true"
      gripper_comm_port="$(arg right_gripper_comm_port)"
  >
  </xacro:robotiq_2f85>

</robot>
